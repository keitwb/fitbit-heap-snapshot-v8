# FitBit Heap Snapshot v8 Converter

This is basically a fork of
https://github.com/Fitbit/developer-bridge/tree/master/packages/memory-profiler that converts the
heap snapshots into a format (v8 heap snapshot) that can be used directly with Chrome Dev Tools.
The format generated by the memory-profiler tool doesn't seem to be compatible with Chrome but the
thing generated by the developer-bridge is pretty close (what FitBit devs call the "jerryscript-1"
format).

There is no published spec on the heap snapshot files for Chrome/v8 or the Jerryscript thing, but
the format seems simple enough.  The following resources were helpful:

 - https://github.com/gondwanasoft/fitbit-heap-explorer
 - https://www.alibabacloud.com/blog/locate-online-node-js-memory-leaks_595120
 - https://blog.actorsfit.com/a?ID=00001-39d9f16f-bb77-42c3-a467-ee8a50e70e2c
 - https://github.com/v8/v8/blob/master/include/v8-profiler.h
 - https://github.com/SrTobi/v8-heapsnapshot/blob/master/src/index.ts
 - https://gist.github.com/mmarchini/303b1699d936d3649a09714be21e1262
 - https://github.com/ChromeDevTools/devtools-frontend/blob/main/front_end/models/heap_snapshot_model/HeapSnapshotModel.ts
 - https://github.com/ChromeDevTools/devtools-frontend/tree/main/front_end/entrypoints/heap_snapshot_worker

# Usage

Use it the same way the memory-profiler tool works:

First, make a heap snapshot with the hidden sdk-cli command `heap-snapshot`.  Then,

```
$ npm run build   # Until the package is published
$ node lib/cli.js /path/to/fitbit-project/js-heap.bin /path/to/fitbit-project/build/app.fba /path/to/output.heapsnapshot atlas
```

The load the file `output.heapsnapshot` in Chrome Dev Tools under the Memory tab.
